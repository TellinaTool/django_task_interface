<!--
The full task interface is implemented in this file. All interaction with the
server is done through HTTP AJAX calls.
-->

<html>
   <head>
      	<meta charset="utf-8">
      	<meta http-equiv="x-ua-compatible" content="ie=edge">
      	<title>Tellina User Study</title>
      	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
      	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
	   <link rel="stylesheet" href="/static/css/xterm.css" />
      	<link href="/static/lib/codecademy.themes/core.css" media="screen" rel="stylesheet"
            type="text/css" />
      	<link href="/static/lib/codecademy.themes/exercise.css" media="screen" rel="stylesheet"
            type="text/css" />
      	<link href="/static/lib/codecademy.themes/vendor.css"
         	media="screen" rel="stylesheet" type="text/css" />
      	<link href="/static/lib/codecademy.themes/platform.css"
         	media="screen" rel="stylesheet" type="text/css" />
      	<link href="/static/css/task.css" rel="stylesheet" media="screen">
      	<link rel="shortcut icon" href="/static/img/tellina.png"/>
   </head>
   <body>
      <div class="react-root" data-react-class="PlatformRouter">
         <section class="_255U1OEW5iAFH7qz_pHXM8" data-reactroot="" data-reactid="1" data-react-checksum="-96644366">
            <div id="workspace" class="francine" data-reactid="2">
               <!-- react-empty: 3 -->
               <header data-react-header="true" class="_2m_hDXMtwvETHFo3eGaTXE" data-reactid="4">
                  <nav class="y7tvmmg7fKu4JpdaYECtN _2Tp4ILE5wDYNdLO-nT8psj" data-reactid="5">
                     <section class="_2zSA2d9oAw82vmGaiCI6HM vE2U5Z1_1p0OevhTkRrpb" data-reactid="6">
                     </section>
                     <section class="_2zSA2d9oAw82vmGaiCI6HM AcoUR5q2eKWoCC4M_4RZD" data-reactid="10">
                        <i class="_2s1fAUUBvIvC87s1stozEY fcn-icon fcn-icon-arrowPrev"
                           data-reactid="12"></i><!-- react-text: 13 -->Complete the task using
                           commandline.<!-- /react-text -->
                     </section>
                     <section class="_2zSA2d9oAw82vmGaiCI6HM _1KKDVD6unnpNtKqV9PPUQP _2kwp78w4gxSQjvTSajoa6Q" data-reactid="14">
                        <div class="_3bI54mnYg5essxyEwnBsko _3nDVtg6dS-0_R6p0nDL-1S" data-reactid="15">
                           <div class="_3KAEuux4zG-obsW0jpG9gw" data-reactid="16"><span data-reactid="17"></span></div>
                        </div>
                        <div class="_3bI54mnYg5essxyEwnBsko _1f1KmfrKUtLxZllTyx0TrC _3nDVtg6dS-0_R6p0nDL-1S _2kwp78w4gxSQjvTSajoa6Q" data-reactid="18">
                           <div class="fcn-godex-status-container" data-reactid="19">
                              <div class="fcn-godex-status--hidden fcn-godex-status" data-reactid="20">
                                 <span data-reactid="21"></span>
                                 <div class="fcn-godex-status__glow" data-reactid="22"></div>
                              </div>
                           </div>
                        </div>
                        <div class="_3bI54mnYg5essxyEwnBsko _1f1KmfrKUtLxZllTyx0TrC _3nDVtg6dS-0_R6p0nDL-1S" data-reactid="23">
                           <div class="_3wrXGt5j2uE4fjlPLrDXEA" data-reactid="24">
                              <div class="_1XRkeRcO7hh1axYhmKiQMM _39K0C3ph1hpmLw6tsBfNnG GEk9Sbt3OmLggMB2aQtSj _1i2HDK_zSufmryADoGTYpD" data-reactid="25">
                                 <span data-reactid="26">
                                    <div class="_2gwf_JaG35W2Q5PrPxyOlQ _3vnnbQAlMOhQFZ-wuCOyca" data-reactid="27"><span class="new-cc-icon icon-bell" data-reactid="28"></span></div>
                                 </span>
                              </div>
                              <!-- react-empty: 29 -->
                           </div>
                        </div>
                        <div class="_3bI54mnYg5essxyEwnBsko _1f1KmfrKUtLxZllTyx0TrC _3nDVtg6dS-0_R6p0nDL-1S" data-reactid="30">
                           <div class="_3wrXGt5j2uE4fjlPLrDXEA" data-reactid="31">
                              <div id="dropdown-toggle" class="_3beJdIRG9xxfeiRwaBD9Cp" data-reactid="32">
                                 <div class="Y8dknuoW8NLiudcM-zQib _1pl0auxsnexFW5uqwCQW_x _2tbl3cOSPjsfIWBMlHZgcG" data-reactid="33">
                                    <img class="wXEAS7H2e7UsikVkXNety" src="http://www.gravatar.com/avatar/?d=mm" data-reactid="34"/>
                                 </div>
                              </div>
                              <!-- react-empty: 35 -->
                           </div>
                        </div>
                     </section>
                  </nav>
               </header>

               <div class="fcn-grid" style="cursor:auto;" data-reactid="51">
                  <!-- Task info -->
                  <div class="fcn-slot fcn-slot--no-top-neighbor fcn-slot--no-bottom-neighbor fcn-slot--no-left-neighbor"
                       style="position:absolute;top:0%;right:80%;bottom:0%;left:0%;">
                     <div class="fcn-component" data-reactid="67">
                        <div class="overlay" data-reactid="68"></div>
                        <div class="accordion-container" data-reactid="70">
                           <div class="accordion" data-reactid="71">
                              <div class="accordion-section" data-reactid="72">
                                 <div data-index="0" class="accordion-section-heading" data-reactid="73">
                                    <div class="_1XRkeRcO7hh1axYhmKiQMM _39K0C3ph1hpmLw6tsBfNnG learn-header" data-reactid="74">
                                       <!-- react-text: 76 -->Task Description<!-- /react-text -->
                                    </div>
                                 </div>
                                 <div class="accordion-section-body" data-reactid="77">
                                    <div class="jfdpfOzslotw2euWgxJNN _1PzvoBkjTI2SFvb5o9YAHW" data-reactid="78">
                                       <pre><code><span wrap="true" class="_18cGopAuUQVCOplu8pL9b5 _12mn8XNbByNCYxyzndA6if _3xp4c3Gvny8Oap6jE2-Q_ _2RE0-ZG6UYzWFn9_EER397 undefined" data-reactroot="" data-reactid="1" data-react-checksum="417103695"><div class="CodeMirror" data-reactid="2">
                                          <!-- react-text: 3 -->$ ls -a<!-- /react-text --><!-- react-text: 4 -->
<!-- /react-text --><!-- react-text: 5 -->.  ..  .preferences  action  drama comedy  genres.xt<!-- /react-text --></div></span>
</code></pre>
                                       <ol>
                                          <li>The <code>ls</code> command lists all files and directories in the working directory.</li>
                                          <li>The <code>-a</code> modifies the behavior of the <code>ls</code> command to also list the files and directories starting with a dot (<code>.</code>). Files started with a dot are hidden, and don&#39;t appear when using <code>ls</code> alone.</li>
                                       </ol>
                                       <p>The <code>-a</code> is called an <em>option</em>. Options modify the behavior of commands. Here we used <code>ls -a</code> to display the contents of the working directory in more detail.</p>
                                       <p>In addition to <code>-a</code>, the <code>ls</code> command has several more options. Here are three common options:</p>
                                       <ul>
                                          <li><code>-a</code> - lists all contents, including hidden files and directories</li>
                                          <li><code>-l</code> - lists all contents of a directory in long format</li>
                                          <li><code>-t</code> - order files and directories by the time they were last modified.</li>
                                       </ul>
                                       <p>Let&#39;s practice using these options below.</p>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>

				  <!-- xterms.js -->
                  <div class="fcn-slot fcn-slot--no-top-neighbor fcn-slot--no-bottom-neighbor"
                       style="position:absolute;top:0%;right:30%;bottom:0%;left:20%;">
                     <div class="fcn-component">
                        <div class="accordion-container terminal">
                           <div data-index="0" class="accordion-section-heading">
                              <div class="_1XRkeRcO7hh1axYhmKiQMM _39K0C3ph1hpmLw6tsBfNnG learn-header"
                                   data-reactid="74">
                                 Terminal
                              </div>
                           </div>
                           <div id="terminal-container"></div>
                        </div>
                     </div>
                  </div>

                  <!-- Direcotry Visualization -->
                  <div class="fcn-slot fcn-slot--no-top-neighbor fcn-slot--no-bottom-neighbor fcn-slot--no-right-neighbor"
                       style="position:absolute;top:0%;right:0%;bottom:0%;left:70%;"
                       data-fcn-arrangement="03" data-reactid="66">
					 <!-- Current Directory -->
                     <div class="fcn-slot fcn-slot--no-top-neighbor fcn-slot--no-bottom-neighbor fcn-slot--no-righ-neighbor"
                          style="position:absolute;top:0%;right:0%;bottom:50%;left:0%;">
                        <div class="fcn-component" data-reactid="67">
                           <div class="accordion-container cur_dir_vis" data-reactid="70">
                              <div data-index="0" class="accordion-section-heading" data-reactid="73">
                                 <div class="_1XRkeRcO7hh1axYhmKiQMM _39K0C3ph1hpmLw6tsBfNnG learn-header"
                                      data-reactid="74">
                                    current directory
                                 </div>
                              </div>
                              <div class="accordion-section-body" data-reactid="77">
                                 <div class="jfdpfOzslotw2euWgxJNN _1PzvoBkjTI2SFvb5o9YAHW" data-reactid="78">
                                    <p>Current directory visualization goes here.</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <!-- Goal Directory -->
                     <div class="fcn-slot fcn-slot--no-top-neighbor fcn-slot--no-bottom-neighbor fcn-slot--no-right-neighbor"
                          style="position:absolute;top:50%;right:0%;bottom:0%;left:0%">
                        <div class="fcn-component" data-reactid="67">
                           <div class="accordion-container goal_dir_vis" data-reactid="70">
                              <div data-index="0" class="accordion-section-heading" data-reactid="73">
                                 <div class="_1XRkeRcO7hh1axYhmKiQMM _39K0C3ph1hpmLw6tsBfNnG learn-header" data-reactid="74">
                                    goal directory
                                 </div>
                              </div>
                              <div class="accordion-section-body" data-reactid="77">
                                 <div class="jfdpfOzslotw2euWgxJNN _1PzvoBkjTI2SFvb5o9YAHW" data-reactid="78">
                                    <p>Goal directory visualization goes here.</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <nav class="y7tvmmg7fKu4JpdaYECtN uLjMYUmq7NHQCvtXjbgKs _3bR5y3xpD2FPv1oUg-7n_p" data-reactid="111">
                  <section class="_2zSA2d9oAw82vmGaiCI6HM vE2U5Z1_1p0OevhTkRrpb" data-reactid="112">
                     <button class="fcn-button fcn-button--warning" data-reactid="124">
                        <!-- react-text: 125 -->QUIT<!-- /react-text --><!-- react-empty: 126 -->
                     </button>
                  </section>
                  <section class="_2zSA2d9oAw82vmGaiCI6HM AcoUR5q2eKWoCC4M_4RZD" data-reactid="117">
                     <div class="fcn-nav-wrapper" data-reactid="118">
                        <div class="fcn-nav-wrapper__center fcn-progress-container" data-reactid="119">
                           <div class="fnc-nav__exercise-count" data-reactid="121">2/10</div>
                        </div>
                     </div>
                  </section>
                  <section class="_2zSA2d9oAw82vmGaiCI6HM _1KKDVD6unnpNtKqV9PPUQP" data-reactid="123">
                     <button class="fcn-button fcn-button--lantern" data-reactid="124">
                        <!-- react-text: 125 -->RESET<!-- /react-text --><!-- react-empty: 126 -->
                     </button>
                  </section>
                  <!-- react-empty: 127 -->
               </nav>
            </div>
         </section>
      </div>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	  <script>
		function getHost() {
		    return location.hostname + ((location.port) ? (':' + location.port) : '');
		}

		var accessCode = prompt("Enter your access code");

		// get the current task ID
		$.get(`/get_current_task_id?access_code=${accessCode}`, function(data) {
			var task_id = parseInt(data);
			console.log(`task_id: ${task_id}`);

			// get details about the current task
			$.get(`/get_task?task_id=${task_id}`, function(data) {
				var task = data;
				console.log(`task: ${JSON.stringify(task)}`);
			});

			alert(`You are starting a session for task ${task_id}. Press OK to continue.`);

			// poll task state
			setInterval(function() {
				$.get(`/check_task_state?access_code=${accessCode}&task_id=${task_id}`, function(data) {
					var state = data;
					console.log(`task state: ${state}`);
					if (state !== 'running') {
						location.reload();
					}
				});
			}, 3000);

			// initialize a sesion for the current task
			$.get(`/initialize_task?access_code=${accessCode}&task_id=${task_id}`, function(data) {
				var sessionID = data;
				console.log(`sessionID: ${sessionID}`);

				// connect to xterm
				var cols = 80;
				var rows = 24;
				var term = new Terminal({ cursorBlink: true });
				var terminalContainer = document.getElementById('terminal-container');
				// clean terminal
				while (terminalContainer.children.length > 0) {
				  terminalContainer.removeChild(terminalContainer.children[0]);
				}
				// associate JS term object with HTML div
				term.open(terminalContainer);
				var charWidth = Math.ceil(term.element.offsetWidth / cols);
				var charHeight = Math.ceil(term.element.offsetHeight / rows);

				var xtermWebSocket = new WebSocket(`ws://${getHost()}/xterm/1/${sessionID}`);
				xtermWebSocket.onopen = function() {
				  term.attach(xtermWebSocket);
				  console.log('Terminal attached');
				};
				xtermWebSocket.onerror = function(event) {
				  console.log('Socket error: ' + event.data);
				};
				xtermWebSocket.onclose = function() {
				  console.log('Socket closed');
				};

				// poll update
				setInterval(function() {
					$.get(`/update_state?access_code=${accessCode}`, function(data) {
						console.log(`updated`);
					});
				}, 2500);

				// poll filesystem
				setInterval(function() {
					$.get(`/get_filesystem?access_code=${accessCode}`, function(data) {
						var filesystem = data;
						console.log(`filesystem: ${JSON.stringify(filesystem)}`);
					});
				}, 2000);
			});
		});
	  </script>
	  <script src="/static/js/xterm.js"></script>
  	  <script src="/static/js/attach.js"></script>

   </body>
</html>
